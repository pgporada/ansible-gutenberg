---
driver:
  name: docker_cli

transport:
  name: docker_cli

provisioner:
  name: ansible_playbook
  hosts: test-kitchen
  require_chef_for_busser: false
  require_ruby_for_busser: false
  requirements_path: <%= ENV['REQUIREMENTS_PATH'] || "test/requirements.yml" %>
  ansible_cfg_path: ansible.cfg
  ansible_verbose: false
  ansible_verbosity: :warn
  ansible_version: latest
  ansible_extra_flags: <%= ENV['ANSIBLE_EXTRA_FLAGS'] %>
  playbook: <%= ENV['PLAYBOOK'] || "test/integration/default/default.yml" %>
  env_vars:
    LOGSTASH_SERVER: <%= ENV['LOGSTASH_SERVER'] || "172.17.0.3" %>
  ignore_paths_from_root:
    - .bundle
    - .kitchen
    - .git
    - tests
    - vendor
#  idempotency_test: true

platforms:
  - name: centos-6
    driver_config:
      platform: centos
      image: geerlingguy/docker-centos6-ansible:latest
      privileged: true
      command: /sbin/init
      network: host
      run_command:
        - sudo yum install -y python-pip
        - sudo pip install --upgrade --ignore-installed --no-cache-dir pip 
        - sudo pip install setuptools==33.1.1 --ignore-installed --no-cache-dir
        - sudo pip install python-logstash --ignore-installed --no-cache-dir

  - name: centos-7
    driver_config:
      platform: centos
      image: geerlingguy/docker-centos7-ansible:latest
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      command: /usr/lib/systemd/systemd
      network: host
      run_command:
        - sudo yum install -y python-pip
        - sudo pip install --upgrade --ignore-installed --no-cache-dir pip 
        - sudo pip install setuptools==33.1.1 --ignore-installed --no-cache-dir
        - sudo pip install python-logstash --ignore-installed --no-cache-dir

  - name: debian-7
    driver_config:
      platform: debian
      image: williamyeh/ansible:debian7
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      #command: /sbin/init
      network: host
      run_command:
        - echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections
        - sudo apt-get clean
        - sudo apt-get update
        - sudo apt-get install -y python-pip
        #- sudo pip install setuptools==33.1.1 --ignore-installed
        - sudo pip install python-logstash --ignore-installed

  - name: debian-8
    driver_config:
      platform: debian
      image: gmazoyer/ansible-docker-debian8
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      #command: true
      network: host
      run_command:
        - echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections
        - sudo apt-get clean
        - sudo apt-get update
        - sudo apt-get install -y python-pip
        - sudo pip install --upgrade --ignore-installed  pip 
        - sudo pip install setuptools==33.1.1 --ignore-installed 
        - sudo pip install python-logstash --ignore-installed 

  - name: debian-9
    driver_config:
      platform: debian
      image: webdevops/ansible:debian-9
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      command: true
      network: host
      run_command:
        - echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections
        - sudo apt-get clean
        - sudo apt-get update
        - sudo apt-get install -y python-pip
        - sudo pip install --upgrade --ignore-installed --no-cache-dir pip 
        - sudo pip install setuptools==33.1.1 --ignore-installed --no-cache-dir
        - sudo pip install wheel virtualenv --upgrade --ignore-installed --no-cache-dir
        - sudo pip install python-logstash --ignore-installed --no-cache-dir

  - name: ubuntu-12.04
    driver_config:
      platform: ubuntu
      image: geerlingguy/docker-ubuntu1204-ansible:latest
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      #command: /sbin/init
      network: host
      run_command:
        - echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections
        - sudo apt-get update
        - sudo apt-get upgrade -y
        - sudo apt-get install -y python-pip
        - sudo pip install setuptools==33.1.1 --ignore-installed
        - sudo pip install python-logstash --ignore-installed

  - name: ubuntu-14.04
    driver_config:
      platform: ubuntu
      image: williamyeh/ansible:ubuntu14.04
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      #command: /usr/lib/systemd/systemd
      network: host
      run_command:
        - echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections
        - sudo apt-get update
        - sudo apt-get upgrade -y
        - sudo apt-get install -y python-pip
        - sudo pip install --upgrade --ignore-installed pip 
        - sudo pip install setuptools==33.1.1 --ignore-installed
        - sudo pip install python-logstash --ignore-installed --no-cache-dir

  - name: ubuntu-16.04
    driver_config:
      platform: ubuntu
      image: geerlingguy/docker-ubuntu1604-ansible:latest
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      #command: /usr/lib/systemd/systemd
      stop_signal: SIGRTMIN+3
      tmpfs:
        - /run
        - /run/lock
      network: host
      run_command:
        - echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections
        - sudo apt-get clean
        - sudo apt-get update
        - sudo apt-get upgrade -y
        - sudo apt-get install -f
        - sudo apt-get install -y python-pip
        - sudo pip install --upgrade --ignore-installed --no-cache-dir pip 
        - sudo pip install setuptools==33.1.1 --ignore-installed --no-cache-dir
        - sudo pip install wheel virtualenv --upgrade --ignore-installed --no-cache-dir
        - sudo pip install python-logstash --ignore-installed --no-cache-dir

  - name: fedora-24
    driver_config:
      platform: rhel
      image: geerlingguy/docker-fedora24-ansible:latest
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      command: /usr/lib/systemd/systemd
      network: host
      run_command:
        - sudo dnf install -y python-pip
        - sudo pip install --upgrade --ignore-installed --no-cache-dir pip 
        - sudo pip install setuptools==33.1.1 --ignore-installed --no-cache-dir
        - sudo pip install python-logstash --ignore-installed --no-cache-dir

  - name: fedora-25
    driver_config:
      platform: rhel
      image: bdellegrazie/docker-fedora25-ansible:latest
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      command: /usr/lib/systemd/systemd
      network: host
      run_command:
        - sudo dnf install -y python-pip
        - sudo pip install --upgrade --ignore-installed --no-cache-dir pip 
        - sudo pip install setuptools==33.1.1 --ignore-installed --no-cache-dir
        - sudo pip install python-logstash --ignore-installed --no-cache-dir

suites:
  - name: default
...
